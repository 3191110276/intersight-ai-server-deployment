---
- name: Provision AI tools on server
  hosts: localhost

  tasks:
  - name: Create a log directory
    ansible.builtin.file:
      path: ./logs
      state: directory

  - name: Add APT Repository for Python
    ansible.builtin.shell: add-apt-repository ppa:deadsnakes/ppa

  - name: Update APT
    ansible.builtin.shell: apt update

  - name: Install Python 3.12
    become: true
    apt:
      name: "{{ item }}"
      state: present
    with_items:
    - python3.12
    - python3.12-venv

  - name: Get Python 3.12 Pythonpath
    shell: "which python3.12"
    register: python_path
    changed_when: false
  
  - name: Install packages
    apt:
      pkg:
      - pip
      - docker.io

  - name: Install Jupyter python package
    ansible.builtin.pip:
      name: jupyterlab

  - name: Install Ollama
    ansible.builtin.shell: curl -fsSL https://ollama.com/install.sh | sh

  - name: Install Ollama python package
    ansible.builtin.pip:
      name: ollama

  - name: Start Jupyter Server
    shell: "jupyter lab --no-browser --port=8090 --ip=0.0.0.0 > ./logs/jupyter.log 2>&1 &"
    async: 2

  - name: Getting the Jupyter Server token
    shell: "cat jupyter.log | grep token"
    register: token
